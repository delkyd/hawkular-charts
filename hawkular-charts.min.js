angular.module("hawkular.charts",[]);var Charts;!function(t){"use strict";var n=angular.module("hawkular.charts"),r=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.UP="up",t.DOWN="down",t.UNKNOWN="unknown",t}();t.AvailStatus=r;var e=function(){function t(t,n,r,e,a,i,o){this.start=t,this.end=n,this.value=r,this.startDate=e,this.endDate=a,this.duration=i,this.message=o,this.duration=moment(n).from(moment(t),!0),this.startDate=new Date(t),this.endDate=new Date(n)}return t}();t.TransformedAvailDataPoint=e;var a=function(){function n(n){var a=this;this.restrict="E",this.replace=!0,this.scope={data:"=",startTimestamp:"@",endTimestamp:"@",chartHeight:"@",timeLabel:"@",dateLabel:"@",noDataLabel:"@",chartTitle:"@"},this.link=function(i,o,s){function u(t){return"<div class='chartHover'>\n        <div>\n        <small>\n          <span class='chartHoverLabel'>Status: </span><span>: </span>\n          <span class='chartHoverValue'>"+t.value.toUpperCase()+"</span>\n        </small>\n        </div>\n          <div>\n          <small>\n            <span class='chartHoverLabel'>Duration</span><span>: </span>\n            <span class='chartHoverValue'>"+t.duration+"</span>\n          </small>\n          </div>\n        </div>"}function c(){T&&L.selectAll("*").remove(),L=d3.select(o[0]),T=L.append("svg").attr("viewBox","0 0 760 150").attr("preserveAspectRatio","xMinYMin meet"),D=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return u(t)}),H=T.append("g").attr("width",M+N.left+N.right).attr("height",$).attr("transform","translate("+N.left+","+U+")"),H.append("defs").append("pattern").attr("id","diagonal-stripes").attr("patternUnits","userSpaceOnUse").attr("patternTransform","scale(0.7)").attr("width",4).attr("height",4).append("path").attr("d","M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr("stroke","#B6B6B6").attr("stroke-width",1.2),H.call(D)}function l(t){var n=[];S=+s.startTimestamp||d3.min(t,function(t){return t.start})||+moment().subtract(1,"hour"),t&&t.length>0&&(n[0]=S,n[1]=+moment(),x=d3.scale.linear().clamp(!0).rangeRound([70,0]).domain([0,175]),w=d3.svg.axis().scale(x).ticks(0).tickSize(0,0).orient("left"),y=d3.time.scale().range([0,M]).domain(n),A=d3.svg.axis().scale(y).tickSize(-70,0).orient("top").tickFormat(d3.time.format.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%H:%M",function(t){return t.getMinutes()}],["%H:%M",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]])))}function f(t){return t.value===r.UP.toString()}function m(t){return t.value===r.UNKNOWN.toString()}function d(t){function n(t,n){return t.timestamp<n.timestamp?-1:t.timestamp>n.timestamp?1:0}var a=[],i=t.length;if(t.sort(n),t&&i>0&&t[0].timestamp){var o=(new Date).getTime();if(1===i){var s=t[0];a.push(new e(o-36e5,s.timestamp,r.UNKNOWN.toString())),a.push(new e(s.timestamp,o,s.value))}else for(var u=o,c=t.length;c>0;c--){if(S>=t[c-1].timestamp){a.push(new e(S,u,t[c-1].value));break}a.push(new e(t[c-1].timestamp,u,t[c-1].value)),u=t[c-1].timestamp}}return a}function p(){H.append("text").attr("class","availUpLabel").attr("x",-10).attr("y",25).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Up"),H.append("text").attr("class","availDownLabel").attr("x",-10).attr("y",55).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Down")}function h(t){function n(t){return I-o(0)+(f(t)||m(t)?0:35)}function r(t){return o(0)-(m(t)?15:50)}function e(t){return f(t)?"#54A24E":m(t)?"url(#diagonal-stripes)":"#D85054"}var a=(d3.min(t,function(t){return+t.start}),d3.max(t,function(t){return+t.end})),i=d3.time.scale().range([0,M]).domain([S,a]),o=d3.scale.linear().clamp(!0).range([I,0]).domain([0,4]);d3.svg.axis().scale(i).ticks(8).tickSize(13,0).orient("top");H.selectAll("rect.availBars").data(t).enter().append("rect").attr("class","availBars").attr("x",function(t){return i(+t.start)}).attr("y",function(t){return n(t)}).attr("height",function(t){return r(t)}).attr("width",function(t){return i(+t.end)-i(+t.start)}).attr("fill",function(t){return e(t)}).attr("opacity",function(){return.85}).on("mouseover",function(t,n){D.show(t,n)}).on("mouseout",function(){D.hide()}),H.append("line").attr("x1",0).attr("y1",70).attr("x2",655).attr("y2",70).attr("stroke-width",.5).attr("stroke","#D0D0D0"),p()}function v(){H.selectAll("g.axis").remove(),k=H.append("g").attr("class","x axis").call(A),H.append("g").attr("class","y axis").call(w)}function g(){function r(){H.classed("selecting",!0)}function e(){var r=C.extent(),e=Math.round(r[0].getTime()),a=Math.round(r[1].getTime()),i=a-e;i>=6e4&&(console.log("Drag: AvailTimeRangeChanged:"+r),n.$broadcast(t.EventNames.AVAIL_CHART_TIMERANGE_CHANGED.toString(),r)),b.call(C.clear())}C=d3.svg.brush().x(y).on("brushstart",r).on("brushend",e),k.append("g").attr("class","x brush").call(C).selectAll("rect").attr("y",0).attr("height",70),b=H.append("g").attr("class","brush").call(C),b.selectAll(".resize").append("path"),b.selectAll("rect").attr("height",70)}var x,y,w,A,k,C,b,D,T,L,H,S=+s.startTimestamp,E=+s.endTimestamp,R=+s.chartHeight||150,N=(s.noDataLabel||"No Data",{top:10,right:5,bottom:5,left:90}),M=750-N.left-N.right,V=R-50,I=V-N.top-N.bottom,_=30,B=10,$=I+N.top-_-B,U=+_+B+N.top;i.$watchCollection("data",function(t){console.log("Avail Chart Data Changed"),t&&(a.transformedDataPoints=d(angular.fromJson(t)),i.render(a.transformedDataPoints))}),i.$watchGroup(["startTimestamp","endTimestamp"],function(t){console.log("Avail Chart Start/End Timestamp Changed"),S=t[0]||S,E=t[1]||E,i.render(a.transformedDataPoints)}),i.render=function(t){console.log("Starting Avail Chart Directive Render"),t&&t.length>0&&(console.group("Render Avail Chart"),console.time("availChartRender"),c(),l(t),v(),h(t),g(),console.timeEnd("availChartRender"),console.groupEnd())}}}return n.Factory=function(){var t=function(t){return new n(t)};return t.$inject=["$rootScope"],t},n}();t.AvailabilityChartDirective=a,n.directive("availabilityChart",a.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";var n=angular.module("hawkular.charts"),r=function(){function n(r){var e=this;this.restrict="E",this.replace=!0,this.scope={data:"="},this.link=function(a,i,o){function s(){y&&w.selectAll("*").remove(),w=d3.select(i[0]),y=w.append("svg").attr("viewBox","0 0 750 100").attr("preserveAspectRatio","xMinYMin meet"),A=y.append("g").attr("width",b+k.left+k.right).attr("height",T).attr("transform","translate("+k.left+","+D+")")}function u(t){console.log("dataPoints.length: "+t.length),p=d3.time.scale().range([0,b-10]).domain([t[0].timestamp,t[t.length-1].timestamp]),h=d3.svg.axis().scale(p).ticks(10).tickSize(4,0).orient("bottom"),A.selectAll("g.axis").remove(),v=A.append("g").attr("class","x axis").attr("transform","translate(0,"+D+")").call(h);var n=d3.min(t,function(t){return t.avg}),r=d3.max(t,function(t){return t.avg});r+=.03*r,n-=.05*n,f=d3.scale.linear().rangeRound([90,0]).domain([n,r]),m=d3.svg.axis().scale(f).ticks(3).tickSize(4,0).orient("left"),d=A.append("g").attr("class","y axis").call(m);var e=d3.svg.area().interpolate("cardinal").defined(function(t){return!t.empty}).x(function(t){return p(t.timestamp)}).y0(function(t){return D}).y1(function(t){return f(t.avg)}),a=d3.svg.line().interpolate("cardinal").defined(function(t){return!t.empty}).x(function(t){return p(t.timestamp)}).y(function(t){return f(t.avg)}),i=A.selectAll("path.contextLine").data([t]);i.attr("class","contextLine").transition().attr("d",a),i.enter().append("path").attr("class","contextLine").transition().attr("d",a),i.exit().remove();var o=A.append("g").attr("class","context");o.append("path").datum(t).transition().duration(500).attr("class","contextArea").attr("d",e)}function c(){function n(){A.classed("selecting",!0)}function e(){var n=g.extent(),e=Math.round(n[0].getTime()),a=Math.round(n[1].getTime()),i=a-e;i>=6e4&&(console.log("Drag: ContextChartTimeRangeChanged:"+n),r.$broadcast(t.EventNames.CONTEXT_CHART_TIMERANGE_CHANGED.toString(),n))}g=d3.svg.brush().x(p).on("brushstart",n).on("brushend",e),v.append("g").selectAll("rect").attr("y",0).attr("height",D-10),x=A.append("g").attr("class","brush").call(g),x.selectAll(".resize").append("path"),x.selectAll("rect").attr("height",85)}function l(t){return t?t.map(function(t){var n=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:n,value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}var f,m,d,p,h,v,g,x,y,w,A,k={top:10,right:5,bottom:5,left:90},C=+o.chartHeight||n._CHART_HEIGHT,b=n._CHART_WIDTH-k.left-k.right,D=C-k.top-k.bottom,T=D+k.top;a.$watchCollection("data",function(t){console.log("Context Chart Data Changed"),t&&(e.dataPoints=l(angular.fromJson(t)),a.render(e.dataPoints))}),a.render=function(t){t&&t.length>0&&(console.group("Render Context Chart"),console.time("contextChartRender"),s(),u(t),c(),console.timeEnd("contextChartRender"),console.groupEnd())}}}return n.Factory=function(){var t=function(t){return new n(t)};return t.$inject=["$rootScope"],t},n._CHART_WIDTH=750,n._CHART_HEIGHT=100,n}();t.ContextChartDirective=r,n.directive("contextChart",r.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";var n=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.CHART_TIMERANGE_CHANGED=new t("ChartTimeRangeChanged"),t.AVAIL_CHART_TIMERANGE_CHANGED=new t("AvailChartTimeRangeChanged"),t.CONTEXT_CHART_TIMERANGE_CHANGED=new t("ContextChartTimeRangeChanged"),t}();t.EventNames=n}(Charts||(Charts={}));var Charts;!function(t){"use strict";var n=!1,r=10,e=function(){function t(t,n,r){this.startTimestamp=t,this.endTimestamp=n,this.alertValue=r,this.startDate=new Date(t),this.endDate=new Date(n)}return t}();angular.module("hawkular.charts").directive("hawkularChart",["$rootScope","$http","$interval","$log",function(a,i,o,s){function u(u,c,l){function f(t){return nt(t.timestamp)}function m(){return 760}function d(){return m()<=jt}function p(){ct&&lt.selectAll("*").remove(),lt=d3.select(c[0]),ct=lt.append("svg").attr("viewBox","0 0 760 "+(Mt+25)).attr("preserveAspectRatio","xMinYMin meet"),b(ct),ft=ct.append("g").attr("width",Wt+qt.left+qt.right).attr("height",tn).attr("transform","translate("+qt.left+","+nn+")"),at=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t,n){return C(t,n)}),ft.call(at),ft.append("g").attr("class","alertHolder"),en=!0}function h(t){function n(){var t,n,r,e,a=[],i=[];return Nt.forEach(function(r){t=d3.max(r.map(function(t){return A(t)?0:t.avg||t.value})),a.push(t),n=d3.min(r.map(function(t){return A(t)?Number.MAX_VALUE:t.avg||t.value})),i.push(n)}),r=d3.max(a),e=d3.min(i),[e,r]}var e,a;if(Nt){var i=n();pt=i[1],ht=i[0]}t&&(pt=d3.max(t.map(function(t){return A(t)?0:t.avg||t.value})),ht=d3.min(t.map(function(t){return A(t)?void 0:t.avg||t.value}))),mt=Jt?0:ht-.05*ht,Dt?(e=1.2*Dt,a=pt+.2*(pt-ht),dt=e>a?e:a):dt=pt+.2*(pt-ht),dt=dt||mt?dt:r}function v(t){var n,r,e=20;t.length>0&&(d()?(Wt=250,n=3,r=2,K=t.slice(t.length-e,t.length)):(n=9,r=5,K=t),h(t),j=function(){return Wt/K.length-rn},Z=function(t){return 0===t||t===K.length-1?j()/2:j()},Q=function(t,n){return nt(t.timestamp)-(0===n?0:j()/2)},tt=d3.scale.linear().clamp(!0).rangeRound([Kt,0]).domain([mt,dt]),rt=d3.svg.axis().scale(tt).ticks(5).tickSize(4,4,0).orient("left"),nt=d3.time.scale().range([0,Wt]).domain(d3.extent(K,function(t){return t.timestamp})),Rt?ut=d3.time.scale().range([0,Wt]).domain(d3.extent(Rt,function(t){return t.timestamp})):st=d3.time.scale().range([0,Wt]).domain(d3.extent(K,function(t){return t.timestamp})),et=d3.svg.axis().scale(nt).ticks(n).tickFormat(d3.time.format("%H:%M")).tickSize(4,4,0).orient("bottom"))}function g(t){function n(){var n,r,e,a,i=[],o=[];return t.forEach(function(t){n=d3.max(t.values.map(function(t){return A(t)?0:t.avg})),i.push(n),r=d3.min(t.values.map(function(t){return A(t)?Number.MAX_VALUE:t.avg})),o.push(r)}),e=d3.max(i),a=d3.min(o),[a,e]}var e,a,i=n();return pt=i[1],ht=i[0],mt=Jt?0:ht-.05*ht,Dt?(e=1.2*Dt,a=pt+.2*(pt-ht),dt=e>a?e:a):dt=pt+.2*(pt-ht),[mt,dt||mt?dt:r]}function x(t){var n=9;if(t&&t[0]&&t[0].values){var r=g(t);mt=r[0],dt=r[1],tt=d3.scale.linear().clamp(!0).rangeRound([Kt,0]).domain([mt,dt]),rt=d3.svg.axis().scale(tt).ticks(5).tickSize(4,4,0).orient("left"),nt=d3.time.scale().range([0,Wt]).domain([d3.min(t,function(t){return d3.min(t.values,function(t){return t.timestamp})}),d3.max(t,function(t){return d3.max(t.values,function(t){return t.timestamp})})]),et=d3.svg.axis().scale(nt).ticks(n).tickFormat(d3.time.format("%H:%M")).tickSize(4,4,0).orient("bottom")}}function y(t,n,r,e,a){void 0===a&&(a=60);var o={headers:{"Hawkular-Tenant":At},params:{start:r,end:e,buckets:a}};if(r>=e&&s.log("Start date was after end date"),t&&kt&&n){var c=kt.split("-");i.get(t+"/"+c[0]+"s/"+n+"/"+(c[1]||"data"),o).success(function(t){vt=w(t),u.render(vt,gt)}).error(function(t,n){s.error("Error Loading Chart Data:"+n+", "+t)})}}function w(t){return t?t.map(function(t){var n=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:n,date:new Date(n),value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}function A(t){return t.empty}function k(t){return"undefined"==typeof t.avg}function C(t,n){var r,e,a,i=t.timestamp,o=moment(t.timestamp).format(Yt);return n>0&&(e=K[n-1].timestamp,a=moment(i).from(moment(e),!0)),r=A(t)?"<div class='chartHover'>\n                <small class='chartHoverLabel'>"+_t+"</small>\n                <div><small><span class='chartHoverLabel'>"+Bt+"</span><span>: </span><span class='chartHoverValue'>"+a+"</span></small> </div>\n                <hr/>\n                <div><small><span class='chartHoverLabel'>"+Gt+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                </div>":k(t)?"<div class='chartHover'>\n                <div><small><span class='chartHoverLabel'>"+Gt+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Bt+"</span><span>: </span><span class='chartHoverValue'>"+a+"</span></small></div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+It+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.value,2)+"</span></small> </div>\n                  </div> ":"<div class='chartHover'>\n                <small>\n                  <span class='chartHoverLabel'>"+Gt+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span>\n                </small>\n                  <div><small><span class='chartHoverLabel'>"+Bt+"</span><span>: </span><span class='chartHoverValue'>"+a+"</span></small> </div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.max,2)+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Ft+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.avg,2)+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+$t+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.min,2)+"</span></small> </div>\n                  </div> "}function b(t){var n=t.append("defs");n.append("pattern").attr("id","noDataStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").append("path").attr("d","M 0 0 6 0").attr("style","stroke:#CCCCCC; fill:none;"),n.append("pattern").attr("id","unknownStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#2E9EC2; fill:none;").append("path").attr("d","M 0 0 6 0"),n.append("pattern").attr("id","downStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#ff8a9a; fill:none;").append("path").attr("d","M 0 0 6 0")}function D(t){var n=t?"leaderBar":"histogram",r=ft.selectAll("rect."+n).data(K);r.attr("class",n).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}).transition().attr("x",function(t,n){return Q(t,n)}).attr("width",function(t,n){return Z(n)}).attr("y",function(t){return A(t)?0:tt(t.avg)}).attr("height",function(t){return Kt-tt(A(t)?tt(dt):t.avg)}).attr("opacity",t?".6":"1").attr("fill",function(n,r){return A(n)?"url(#noDataStripes)":t?"#D3D3D6":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return"0"}).attr("data-hawkular-value",function(t){return t.avg}),r.enter().append("rect").on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}).attr("class",n).transition().attr("x",function(t,n){return Q(t,n)}).attr("width",function(t,n){return Z(n)}).attr("y",function(t){return A(t)?0:tt(t.avg)}).attr("height",function(t){return Kt-tt(A(t)?tt(dt):t.avg)}).attr("opacity",t?".6":"1").attr("fill",function(n,r){return A(n)?"url(#noDataStripes)":t?"#D3D3D6":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return"0"}).attr("data-hawkular-value",function(t){return t.avg}),r.exit().remove(),Pt?ft.selectAll(".histogramTopStem, .histogramBottomStem, .histogramTopCross, .histogramBottomCross").remove():T(t)}function T(t){if(t){var n=ft.selectAll("rect.high, rect.singleValue").data(K);n.attr("class",function(t){return t.min===t.max?"singleValue":"high"}).attr("x",function(t,n){return Q(t,n)}).attr("y",function(t){return tt(isNaN(t.max)?mt:t.max)}).attr("height",function(t){return A(t)?0:tt(t.avg)-tt(t.max)||2}).attr("width",function(t,n){return Z(n)}).attr("data-rhq-value",function(t){return t.max}).attr("opacity",.9).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),n.enter().append("rect").attr("class",function(t){return t.min===t.max?"singleValue":"high"}).attr("x",function(t,n){return Q(t,n)}).attr("y",function(t){return tt(isNaN(t.max)?mt:t.max)}).attr("height",function(t){return A(t)?0:tt(t.avg)-tt(t.max)||2}).attr("width",function(t,n){return Z(n)}).attr("data-rhq-value",function(t){return t.max}).attr("opacity",.9).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),n.exit().remove();var r=ft.selectAll("rect.low").data(K);r.attr("class","low").attr("x",function(t,n){return Q(t,n)}).attr("y",function(t){return isNaN(t.avg)?Kt:tt(t.avg)}).attr("height",function(t){return A(t)?0:tt(t.min)-tt(t.avg)}).attr("width",function(t,n){return Z(n)}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.min}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),r.enter().append("rect").attr("class","low").attr("x",function(t,n){return Q(t,n)}).attr("y",function(t){return isNaN(t.avg)?Kt:tt(t.avg)}).attr("height",function(t){return A(t)?0:tt(t.min)-tt(t.avg)}).attr("width",function(t,n){return Z(n)}).attr("opacity",.9).attr("data-rhq-value",function(t){return t.min}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),r.exit().remove()}else{var e="0.6",a=ft.selectAll(".histogramTopStem").data(K);a.attr("class","histogramTopStem").filter(function(t){return!A(t)}).attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return e}),a.enter().append("line").filter(function(t){return!A(t)}).attr("class","histogramTopStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return e}),a.exit().remove();var i=ft.selectAll(".histogramBottomStem").data(K);i.filter(function(t){return!A(t)}).attr("class","histogramBottomStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.avg)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return e}),i.enter().append("line").filter(function(t){return!A(t)}).attr("class","histogramBottomStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.avg)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return e}),i.exit().remove();var o=ft.selectAll(".histogramTopCross").data(K);o.filter(function(t){return!A(t)}).attr("class","histogramTopCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return e}),o.enter().append("line").filter(function(t){return!A(t)}).attr("class","histogramTopCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return e}),o.exit().remove();var s=ft.selectAll(".histogramBottomCross").data(K);s.filter(function(t){return!A(t)}).attr("class","histogramBottomCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.min)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return e}),s.enter().append("line").filter(function(t){return!A(t)}).attr("class","histogramBottomCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.min)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return e}),s.exit().remove()}}function L(){var t=d3.svg.line().interpolate(Tt).defined(function(t){return!A(t)}).x(function(t){return nt(t.timestamp)}).y(function(t){return tt(k(t)?t.value:t.avg)}),n=ft.selectAll("path.metricLine").data([K]);n.attr("class","metricLine").transition().attr("d",t),n.enter().append("path").attr("class","metricLine").transition().attr("d",t),n.exit().remove()}function H(t){var n=d3.scale.category10(),r=0;t?(ft.selectAll("path[id^='multiLine']")[0].forEach(function(n){var r=!1;t.forEach(function(t){t.keyHash=t.keyHash||"multiLine"+W(t.key),n.getAttribute("id")===t.keyHash&&(r=!0)}),r||n.remove()}),t.forEach(function(t,e){if(t&&t.values){t.keyHash=t.keyHash||"multiLine"+W(t.key);var a=ft.selectAll("path#"+t.keyHash).data([t.values]);a.attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color||n(r++)}).transition().attr("d",I("linear")),a.enter().append("path").attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color?t.color:n(r++)}).transition().attr("d",I("linear")),a.exit().remove()}})):s.warn("No multi-data set for multiline chart")}function S(){var t=d3.svg.area().interpolate(Tt).defined(function(t){return!A(t)}).x(function(t){return f(t)}).y(function(t){return tt(k(t)?t.value:t.max)}).y0(function(t){return tt(k(t)?t.value:t.avg)}),n=d3.svg.area().interpolate(Tt).defined(function(t){return!A(t)}).x(function(t){return f(t)}).y(function(t){return tt(k(t)?t.value:t.avg)}).y0(function(t){return Pt?Kt:tt(t.min)}),r=d3.svg.area().interpolate(Tt).defined(function(t){return!A(t)}).x(function(t){return f(t)}).y(function(t){return tt(k(t)?t.value:t.min)}).y0(function(){return Kt});if(!Pt){var e=ft.selectAll("path.highArea").data([K]);e.attr("class","highArea").attr("d",t),e.enter().append("path").attr("class","highArea").attr("d",t),e.exit().remove();var a=ft.selectAll("path.lowArea").data([K]);a.attr("class","lowArea").attr("d",r),a.enter().append("path").attr("class","lowArea").attr("d",r),a.exit().remove()}var i=ft.selectAll("path.avgArea").data([K]);i.attr("class","avgArea").transition().attr("d",n),i.enter().append("path").attr("class","avgArea").transition().attr("d",n),i.exit().remove()}function E(){if(Pt)ft.selectAll(".highDot, .lowDot").remove();else{var t=ft.selectAll(".highDot").data(K);t.attr("class","highDot").filter(function(t){return!A(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),t.enter().append("circle").filter(function(t){return!A(t)}).attr("class","highDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),t.exit().remove();var n=ft.selectAll(".lowDot").data(K);n.attr("class","lowDot").filter(function(t){return!A(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),n.enter().append("circle").filter(function(t){return!A(t)}).attr("class","lowDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),n.exit().remove()}var r=ft.selectAll(".avgDot").data(K);r.attr("class","avgDot").filter(function(t){return!A(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),r.enter().append("circle").filter(function(t){return!A(t)}).attr("class","avgDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),r.exit().remove()}function R(){var t=ft.selectAll(".scatterLineTopStem").data(K);t.attr("class","scatterLineTopStem").filter(function(t){return!A(t)}).attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.avg)}).attr("stroke",function(t){return"#000"}),t.enter().append("line").filter(function(t){return!A(t)}).attr("class","scatterLineTopStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.avg)}).attr("stroke",function(t){return"#000"}),t.exit().remove();var n=ft.selectAll(".scatterLineBottomStem").data(K);n.attr("class","scatterLineBottomStem").filter(function(t){return!A(t)}).attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.avg)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"#000"}),n.enter().append("line").filter(function(t){return!A(t)}).attr("class","scatterLineBottomStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return tt(t.avg)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"#000"}),n.exit().remove();var r=ft.selectAll(".scatterLineTopCross").data(K);r.attr("class","scatterLineTopCross").filter(function(t){return!A(t)}).attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),r.enter().append("line").filter(function(t){return!A(t)}).attr("class","scatterLineTopCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.max)}).attr("y2",function(t){return tt(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),r.exit().remove();var e=ft.selectAll(".scatterLineBottomCross").data(K);e.attr("class","scatterLineBottomCross").filter(function(t){return!A(t)}).attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.min)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),e.enter().append("line").filter(function(t){return!A(t)}).attr("class","scatterLineBottomCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return tt(t.min)}).attr("y2",function(t){return tt(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),e.exit().remove();var a=ft.selectAll(".scatterDot").data(K);a.attr("class","scatterDot").filter(function(t){return!A(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),a.enter().append("circle").filter(function(t){return!A(t)}).attr("class","scatterDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return tt(k(t)?t.value:t.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),a.exit().remove()}function N(){if(tt){var t=ft.selectAll("g.grid.y_grid");t[0].length||(t=ft.append("g").classed("grid y_grid",!0)),t.call(d3.svg.axis().scale(tt).orient("left").ticks(10).tickSize(-Wt,0).tickFormat(""))}}function M(){var t;rt&&(ft.selectAll("g.axis").remove(),t=ft.append("g").attr("class","x axis").attr("transform","translate(0,"+Kt+")").call(et),t.append("g").attr("class","x brush").call(it).selectAll("rect").attr("y",-6).attr("height",30),ft.append("g").attr("class","y axis").call(rt).append("text").attr("transform","rotate(-90),translate(0,-50)").attr("x",-Mt/2).style("text-anchor","start").text("NONE"===l.yAxisUnits?"":l.yAxisUnits))}function V(t){var n=t||"monotone",r=d3.svg.line().interpolate(n).defined(function(t){return!A(t)}).x(function(t){return nt(t.timestamp)}).y(function(t){return tt(k(t)?t.value:t.avg)});return r}function I(t){var n=t||"monotone",r=d3.svg.line().interpolate(n).defined(function(t){return!A(t)}).x(function(t){return nt(t.timestamp)}).y(function(t){return tt(k(t)?t.value:t.avg)});return r}function _(){if("bar"===Vt||"scatterline"===Vt){var t=ft.selectAll(".barAvgLine").data([K]);t.attr("class","barAvgLine").attr("d",V("monotone")),t.enter().append("path").attr("class","barAvgLine").attr("d",V("monotone")),t.exit().remove()}}function B(t){var n=d3.svg.line().interpolate("monotone").x(function(t){return nt(t.timestamp)}).y(function(n){return tt(t)});return n}function $(t){var n=ft.selectAll("path.alertLine").data([K]);n.attr("class","alertLine").attr("d",B(t)),n.enter().append("path").attr("class","alertLine").attr("d",B(t)),n.exit().remove()}function U(t,n){function r(t,n){var r,e=[];return t.forEach(function(a,i){0===i&&a.avg>n?e.push(i):(r=t[i-1],
a.avg>n&&r&&(!r.avg||r.avg<=n)&&e.push(r.avg?i-1:i))}),e}function a(n,r){var a,i,o,s=[];return n.forEach(function(n){o=t[n];for(var u=n;u<t.length-1;u++)if(a=t[u],i=t[u+1],a.avg>r&&i.avg<=r||a.avg>r&&!i.avg){s.push(new e(o.timestamp,i.avg?i.timestamp:a.timestamp,r));break}}),s.length===n.length-1&&s.push(new e(t[n[n.length-1]].timestamp,t[t.length-1].timestamp,r)),s}var i,o;t[0],t[t.length-1];return o=r(t,n),i=a(o,n)}function F(t){var n=ft.select("g.alertHolder").selectAll("rect.alertBounds").data(t);n.attr("class","alertBounds").attr("x",function(t){return nt(t.startTimestamp)}).attr("y",function(){return tt(dt)}).attr("height",function(t){return 185}).attr("width",function(t){return nt(t.endTimestamp)-nt(t.startTimestamp)}),n.enter().append("rect").attr("class","alertBounds").attr("x",function(t){return nt(t.startTimestamp)}).attr("y",function(){return tt(dt)}).attr("height",function(t){return 185}).attr("width",function(t){return nt(t.endTimestamp)-nt(t.startTimestamp)}),n.exit().remove()}function G(){function n(){ft.classed("selecting",!0)}function r(){var n=it.extent(),r=Math.round(n[0].getTime()),e=Math.round(n[1].getTime()),i=e-r;ft.classed("selecting",!d3.event.target.empty()),i>=6e4&&a.$broadcast(t.EventNames.CHART_TIMERANGE_CHANGED.toString(),n),ot.call(it.clear())}ot=ft.selectAll("g.brush"),ot.empty()&&(ot=ft.append("g").attr("class","brush")),it=d3.svg.brush().x(nt).on("brushstart",n).on("brushend",r),ot.call(it),ot.selectAll(".resize").append("path"),ot.selectAll("rect").attr("height",Kt)}function O(t){t&&ft.append("path").datum(t).attr("class","prevRangeAvgLine").style("stroke-dasharray","9,3").attr("d",V("linear"))}function z(){var t=d3.scale.category20();Nt&&(s.log("Running MultiChartOverlay for %i metrics",Nt.length),Nt.forEach(function(n){ft.append("path").datum(n).attr("class","multiLine").attr("fill",function(n,r){return t(r)}).attr("stroke",function(n,r){return t(r)}).attr("stroke-width","1").attr("stroke-opacity",".8").attr("d",V("linear"))}))}function P(t){t&&ft.selectAll(".annotationDot").data(t).enter().append("circle").attr("class","annotationDot").attr("r",5).attr("cx",function(t){return nt(t.timestamp)}).attr("cy",function(){return Kt-tt(dt)}).style("fill",function(t){return"1"===t.severity?"red":"2"===t.severity?"yellow":"white"})}function J(t){var n=1,r=ft.selectAll(".dataPointDot").data(t);r.attr("class","dataPointDot").attr("r",n).attr("cx",function(t){return nt(t.timestamp)}).attr("cy",function(t){return t.avg?tt(t.avg):-9999999}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),r.enter().append("circle").attr("class","dataPointDot").attr("r",n).attr("cx",function(t){return nt(t.timestamp)}).attr("cy",function(t){return t.avg?tt(t.avg):-9999999}).on("mouseover",function(t,n){at.show(t,n)}).on("mouseout",function(){at.hide()}),r.exit().remove()}function Y(){Lt=Date.now(),Ht=moment().subtract(Ct,"seconds").valueOf(),y(yt,wt,Ht,Lt,60)}function q(t){switch(t){case"rhqbar":D(!0);break;case"histogram":D(!1);break;case"line":case"hawkularline":case"hawkularmetric":L();break;case"multiline":H(X);break;case"area":S();break;case"scatter":E();break;case"scatterline":R();break;default:s.warn("chart-type is not valid. Must be in [rhqbar,area,line,multiline,scatter,scatterline,histogram] chart type: "+t)}}function W(t){var n,r,e,a=0;if(0==t.length)return a;for(n=0,e=t.length;e>n;n++)r=t.charCodeAt(n),a=(a<<5)-a+r,a|=0;return a}var X,K,j,Z,Q,tt,nt,rt,et,at,it,ot,st,ut,ct,lt,ft,mt,dt,pt,ht,vt,gt,xt=[],yt=l.metricUrl,wt=l.metricId||"",At=l.metricTenantId||"",kt=l.metricType||"gauge",Ct=+l.timeRangeInSeconds||43200,bt=+l.refreshIntervalInSeconds||3600,Dt=+l.alertValue,Tt=l.interpolation||"monotone",Lt=Date.now(),Ht=Lt-Ct,St=[],Et=[],Rt=[],Nt=[],Mt=+l.chartHeight||250,Vt=l.chartType||"hawkularline",It=(l.timeLabel||"Time",l.dateLabel||"Date",l.singleValueLabel||"Raw Value"),_t=l.noDataLabel||"No Data",Bt=(l.aggregateLabel||"Aggregate",l.startLabel||"Start",l.endLabel||"End",l.durationLabel||"Interval"),$t=l.minLabel||"Min",Ut=l.maxLabel||"Max",Ft=l.avgLabel||"Avg",Gt=l.timestampLabel||"Timestamp",Ot=!0,zt=!1,Pt=!1,Jt=!1,Yt=(l.chartHoverDateFormat||"%m/%d/%y",l.chartHoverTimeFormat||"%I:%M:%S %p",l.buttonbarDatetimeFormat||"MM/DD/YYYY h:mm a"),qt={top:10,right:5,bottom:5,left:90},Wt=750-qt.left-qt.right,Xt=Mt-50,Kt=Xt-qt.top-qt.bottom,jt=600,Zt=30,Qt=10,tn=Kt+qt.top-Zt-Qt+qt.bottom,nn=+Zt+Qt+qt.top,rn=2,en=!1;xt=l.data,zt=l.showDataPoints,St=l.previousRangeData,Nt=l.multiChartOverlayData,Et=l.annotationData,Rt=l.contextData;var an;u.$watchCollection("data",function(t){t&&(vt=angular.fromJson(t),u.render(vt,gt))}),u.$watch("multiData",function(t){t&&(X=angular.fromJson(t),u.render(vt,gt))},!0),u.$watch("previousRangeData",function(t){t&&(gt=angular.fromJson(t),u.render(vt,gt))},!0),u.$watch("annotationData",function(t){t&&(Et=angular.fromJson(t),u.render(vt,gt))},!0),u.$watch("contextData",function(t){t&&(Rt=angular.fromJson(t),u.render(vt,gt))},!0),u.$on("MultiChartOverlayDataChanged",function(t,n){s.log("Handling MultiChartOverlayDataChanged in Chart Directive"),Nt=n?angular.fromJson(n):[],u.render(vt,gt)}),u.$watchGroup(["alertValue","chartType","hideHighLowValues","useZeroMinValue","showAvgLine"],function(t){Dt=t[0]||Dt,Vt=t[1]||Vt,Pt="undefined"!=typeof t[2]?t[2]:Pt,Jt="undefined"!=typeof t[3]?t[3]:Jt,Ot="undefined"!=typeof t[4]?t[4]:Ot,u.render(vt,gt)}),u.$watchGroup(["metricUrl","metricId","metricType","metricTenantId","timeRangeInSeconds"],function(t){yt=t[0]||yt,wt=t[1]||wt,kt=t[2]||wt,At=t[3]||At,Ct=t[4]||Ct,Y()}),u.$watch("refreshIntervalInSeconds",function(t){t&&(bt=+t,o.cancel(an),an=o(function(){Y()},1e3*bt))}),u.$on("$destroy",function(){o.cancel(an)}),u.$on("DateRangeDragChanged",function(t,n){u.$emit("GraphTimeRangeChangedEvent",n)}),u.render=function(t,r){(t||X)&&(n&&console.group("Render Chart"),n&&console.time("chartRender"),en||p(),t&&v(t),X&&x(X),Dt&&Dt>mt&&dt>Dt&&F(U(K,Dt)),G(),N(),q(Vt),zt&&J(K),O(r),z(),M(),Ot&&_(),Dt&&Dt>mt&&dt>Dt&&$(Dt),Et&&P(Et),n&&console.timeEnd("chartRender"),n&&console.groupEnd("Render Chart"))}}return{link:u,restrict:"E",replace:!0,scope:{data:"=",multiData:"=",metricUrl:"@",metricId:"@",metricType:"@",metricTenantId:"@",startTimestamp:"@",endTimestamp:"@",timeRangeInSeconds:"@",refreshIntervalInSeconds:"@",previousRangeData:"@",annotationData:"@",contextData:"@",showDataPoints:"=",alertValue:"@",interpolation:"@",multiChartOverlayData:"@",chartHeight:"@",chartType:"@",yAxisUnits:"@",useZeroMinValue:"=",buttonbarDatetimeFormat:"@",timeLabel:"@",dateLabel:"@",chartHoverDateFormat:"@",chartHoverTimeFormat:"@",singleValueLabel:"@",noDataLabel:"@",aggregateLabel:"@",startLabel:"@",endLabel:"@",durationLabel:"@",minLabel:"@",maxLabel:"@",avgLabel:"@",timestampLabel:"@",showAvgLine:"=",hideHighLowValues:"=",chartTitle:"@"}}}])}(Charts||(Charts={}));